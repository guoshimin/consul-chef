#!/bin/bash

docker run -d \
  --net host \
  --name consul \
  --restart=always \
  --log-driver=journald \
  -v /consul/data:/consul/data \
  -v /consul/config:/consul/config \
  registry.dev.databricks.com/universe/consul \
  sudo -u consul /databricks/consul/consul \
  agent \
  -bootstrap-expect=3 \
  -node=<%= node['name'] %> \
  -config-file=/consul/config/server.json "$@"
